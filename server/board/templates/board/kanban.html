{% load static %}
<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{{ board.name }} — StudioBoard</title>
  <link rel="stylesheet" href="{% static 'board/kanban.css' %}">
</head>
<body>
{% include "board/_header.html" %}
  <header>
    <div class="header-inner">
      <div class="header-brand">
        <div class="header-kicker">StudioBoard</div>
        <div class="header-title">{{ board.name }}</div>
      </div>
      <div class="header-actions">
        <form class="search" method="get" action="">
          <input
            class="search-input"
            type="text"
            name="q"
            value="{{ q }}"
            placeholder="Rechercher…"
            autocomplete="off"
          />
          <button class="search-clear" type="button" aria-label="Effacer la recherche" title="Effacer">✕</button>
          {% if tag %}<input type="hidden" name="tag" value="{{ tag }}">{% endif %}
          {% if col %}<input type="hidden" name="col" value="{{ col }}">{% endif %}
        </form>

        <form class="quick-add" method="post" action="{% url 'board:quick_add' board.id %}">
          {% csrf_token %}
          <input
            class="quick-add-input"
            type="text"
            name="title"
            placeholder="Ajouter une idée… (#tags @colonne !impact)"
            autocomplete="off"
            maxlength="180"
            required
          />
          <button class="btn btn-primary" type="submit">Ajouter</button>
        </form>

        <a class="btn btn-secondary" href="{% url 'board:idea_new' board.id %}">+ Détails</a>
        <a class="btn btn-secondary" href="{% url 'board:template_list' board.id %}">Templates</a>

        <div id="saveStatus" class="save-status" aria-live="polite">Prêt</div>
      </div>
    </div>
  </header>

  <div class="wrap">
    <div class="board">
      {% for col in columns %}
        <section class="col">
          <h2>{{ col.name }}</h2>
          <div class="cards" data-column-id="{{ col.id }}">
            {% if col.ideas.all %}
              {% for idea in col.ideas.all %}
                <a class="card" data-idea-id="{{ idea.id }}" href="{% url 'board:idea_detail' board.id idea.id %}">
                  <div class="drag-handle" title="Déplacer">⋮⋮</div>
                  <p class="title">{{ idea.title }}</p>
                  <div class="meta">
                    {% for tag in idea.tags.all %}
                      <span class="tag">#{{ tag.name }}</span>
                    {% endfor %}
                    {% if idea.impact %}
                      <span class="tag">⭐ {{ idea.impact }}</span>
                    {% endif %}
                  </div>
                </a>
              {% endfor %}
            {% else %}
              <div class="empty">Aucune carte ici pour le moment.</div>
            {% endif %}
          </div>
        </section>
      {% endfor %}
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.2/Sortable.min.js"></script>
  <script>
    window.STUDIOBOARD = {
      boardId: {{ board.id }},
      reorderUrl: "{% url 'board:kanban_reorder' board.id %}",
    };
  </script>
  <script src="{% static 'board/kanban.js' %}" defer></script>
</body>
</html>